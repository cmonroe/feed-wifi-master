From d2fcf342a022d896d0f98d2cff3674b696b860b3 Mon Sep 17 00:00:00 2001
From: TomLiu <tomml.liu@mediatek.com>
Date: Thu, 18 Jul 2024 22:25:40 +0000
Subject: [PATCH] [mt76]mt7915 add airtime filter for airtime spike

---
 mcu.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/mt7915/mcu.c
+++ b/mt7915/mcu.c
@@ -3317,9 +3317,11 @@ int mt7915_mcu_get_chan_mib_info(struct
 	if (chan_switch)
 		goto out;
 
-	state->cc_tx += cc_tx - state_ts->cc_tx;
+   if (cc_tx - state_ts->cc_tx < 150000)	
+		state->cc_tx += cc_tx - state_ts->cc_tx;
 	state->cc_bss_rx += __res_u64(2) - state_ts->cc_bss_rx;
-	state->cc_rx += __res_u64(2) + __res_u64(3) - state_ts->cc_rx;
+   if (__res_u64(2) + __res_u64(3) - state_ts->cc_rx < 150000)
+		state->cc_rx += __res_u64(2) + __res_u64(3) - state_ts->cc_rx;
 	state->cc_busy += __res_u64(0) + cc_tx + __res_u64(2) + __res_u64(3) -
 			  state_ts->cc_busy;
 
